# Phase 03: Specialized Snipers - Plan 01 (Alvara Protocol)

## Objective
Implement a functional ERC-7621 (Alvara Protocol) execution wrapper in Python that allows an LLM (Grok) to act as a fund manager, automatically rebalancing a tokenized crypto basket on an EVM network.

## Context
While Jarvis is primarily a Solana application, this specific strategy targets EVM using the relatively new ERC-7621 standard. The system requires an isolated Web3 instance and an LLM pipeline that converts narrative sentiment into precise token weightings.

## Implementation Steps

### Task 1: EVM Client & ABI Scaffolding
- **Objective:** Create a Web3.py execution layer compatible with `core.security.key_manager`.
- **Action:**
  - Create `bots/alvara_manager/client.py`.
  - Define minimum ERC-7621 ABI stubs (focusing on `rebalance`, `mint`, and `burn` methods).
  - Initialize the `Web3` connection to a standard RPC (e.g. Infura/Alchemy) and securely load the EVM wallet from `KeyManager`.

### Task 2: Grok Basket Intel Modeler
- **Objective:** Turn qualitative X/Twitter intel into quantitative portfolio weights.
- **Action:**
  - Create `bots/alvara_manager/grok_allocator.py`.
  - Write a prompt wrapper calling the Grok API requesting specific sector allocations (e.g. {"WETH": 40, "LINK": 30, "UNI": 30}).
  - Enforce `pydantic` schemas to ensure weights always equal 100%.

### Task 3: Execution Runner
- **Objective:** Tie the Allocator to the EVM Client on a scheduler loop.
- **Action:**
  - Create `bots/alvara_manager/runner.py`.
  - Write the `async def basket_rebalance_loop()` executing a mock run sequence.
  - Implement circuit breakers to reject rebalances if gas is too high or Grok returns unmapped tokens.

## Verification Plan
### Automated Tests
- Create `core/open_claw/tests/test_alvara.py` or equivalent.
- Run `pytest` to assert that:
  - The Python Grok response parser inherently rejects allocations that do not equal exactly 100%.
  - The Mock Web3 client correctly formats the transaction payload for the generic ERC-7621 Factory proxy address.
  - The fallback loop exits gracefully if the RPC goes down.
