---
phase: 02.1-backtesting-pipeline
plan: 01
subsystem: historical-data-pipeline
tags: [ohlcv, birdeye, dexscreener, backtesting, memecoin, synthetic-data]
dependency-graph:
  requires: []
  provides:
    - multi-source OHLCV fetcher (DexScreener + Birdeye + synthetic)
    - memecoin graduation synthetic data generator
  affects:
    - 02.1-02 (backtest validation runs depend on real OHLCV data)
    - 02.1-03 (backtest API route uses generateMemeGraduationCandles)
tech-stack:
  added: []
  patterns:
    - 3-tier data source fallback (primary -> fallback -> synthetic)
    - Ornstein-Uhlenbeck process for synthetic candle generation
    - Adaptive rate limiting based on API source
key-files:
  created: []
  modified:
    - src/lib/historical-data.ts
decisions:
  - id: birdeye-fallback
    decision: Use Birdeye public OHLCV API as Tier 2 fallback when DexScreener returns empty
    rationale: DexScreener frequently returns empty arrays for blue chip tokens, undermining backtest validity
  - id: meme-synthetic-calibration
    decision: Generate 100 synthetic memecoin datasets across 4 pattern archetypes instead of fetching historical data
    rationale: Most memecoins die within hours post-graduation; no free API serves historical data for dead tokens
  - id: adaptive-rate-limit
    decision: Use 1s delay when Birdeye is source vs 500ms for DexScreener
    rationale: Birdeye public API is rate-limited to ~5 req/min; need to respect this
metrics:
  duration: ~9 minutes
  completed: 2026-02-10
---

# Phase 02.1 Plan 01: Historical Data Pipeline Hardening Summary

**One-liner:** Multi-source OHLCV fetcher with Birdeye fallback and memecoin graduation pattern calibration using Ornstein-Uhlenbeck process

## What Was Done

### Task 1: Birdeye OHLCV Fallback (commit e340617)

Added `fetchFromBirdeye()` as a Tier 2 fallback in the historical data pipeline:

- **Endpoint:** `https://public-api.birdeye.so/defi/ohlcv` with optional `NEXT_PUBLIC_BIRDEYE_API_KEY`
- **Response mapping:** `unixTime` -> `timestamp * 1000`, `o/h/l/c/v` -> OHLCV fields
- **Retry logic:** Single retry after 3s delay on HTTP 429 or 5xx errors
- **Logging:** `console.warn` with HTTP status on failure for debugging visibility
- **`OHLCVSource` type:** Explicit union type `'dexscreener' | 'birdeye' | 'synthetic'`

Updated `fetchTokenHistory()` to 3-tier fallback:
1. DexScreener chart API (primary)
2. Birdeye OHLCV API (if DexScreener < 100 candles, fetch 6 months)
3. Synthetic candles (last resort)

Updated `fetchAllBlueChipHistory()` with adaptive rate limiting:
- 500ms between requests when DexScreener is source
- 1000ms between requests when Birdeye was used

### Task 2: Memecoin Graduation Synthetic Data (commit 26620fd)

Added `generateMemeGraduationCandles()` producing realistic synthetic candle sets:

- **Pattern distribution:** 15% moon, 35% pump_dump, 30% slow_bleed, 20% dead_on_arrival
- **Calibration:** 15-40% hourly volatility, 0.00001-0.001 starting price range
- **Resolution:** 24-72 candles at 1h intervals (1-3 days post-graduation)
- **Process:** Ornstein-Uhlenbeck with pattern-specific drift functions
- **Volume:** Log-normal distribution with 10x-100x variance spikes

Types exported:
- `MemeGraduationPattern` = `'moon' | 'pump_dump' | 'slow_bleed' | 'dead_on_arrival'`
- `MemeGraduationDataSet` extends `HistoricalDataSet` with `pattern` field

## Deviations from Plan

None - plan executed exactly as written.

## Verification Results

| Check | Result |
|-------|--------|
| `npx tsc --noEmit` | 0 errors |
| `fetchFromBirdeye` in file | Line 134 (definition), line 324 (usage) |
| `generateMemeGraduationCandles` in file | Line 568 (exported) |
| `MemeGraduationDataSet` in file | Line 36 (exported interface) |
| 3-tier fallback chain | Lines 303/312/323 (Tier 1/2/3 comments) |
| localStorage guards | Lines 249, 262, 277, 300 (all guarded) |

## Next Phase Readiness

- Historical data pipeline is now hardened with multi-source OHLCV fetching
- Memecoin graduation patterns are ready for strategy backtesting
- No blockers for Plan 02 (backtest validation runs) or Plan 03 (API integration)
